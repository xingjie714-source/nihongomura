<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>求人検索 - 日本語村</title>
    <link rel="stylesheet" href="css/common.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .jobs-page {
            min-height: calc(100vh - 200px);
        }
        .hero-section {
            background: linear-gradient(135deg, #FF6B35, #FF8C42);
            color: white;
            padding: 4rem 2rem;
            text-align: center;
        }
        .hero-section h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        .search-section {
            max-width: 1200px;
            margin: -3rem auto 2rem;
            padding: 0 2rem;
        }
        .search-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .search-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        .filter-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark-gray);
        }
        .filter-group select,
        .filter-group input {
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        .search-buttons {
            display: flex;
            gap: 1rem;
        }
        .btn {
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
        }
        .btn-primary {
            background: var(--primary-orange);
            color: white;
            flex: 1;
        }
        .btn-primary:hover {
            background: #E55A2B;
        }
        .btn-secondary {
            background: white;
            color: var(--primary-orange);
            border: 2px solid var(--primary-orange);
        }
        .btn-secondary:hover {
            background: var(--primary-orange);
            color: white;
        }
        .jobs-list {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        .job-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .job-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }
        .job-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }
        .job-title {
            font-size: 1.5rem;
            color: var(--dark-gray);
            margin-bottom: 0.5rem;
        }
        .company-name {
            color: var(--medium-gray);
            font-size: 1.1rem;
        }
        .job-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .tag {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            background: var(--light-gray);
            color: var(--dark-gray);
        }
        .tag.visa {
            background: #4CAF50;
            color: white;
        }
        .job-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }
        .info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--medium-gray);
        }
        .info-item i {
            color: var(--primary-orange);
        }
        .no-jobs {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--medium-gray);
        }
        .no-jobs i {
            font-size: 4rem;
            color: var(--light-gray);
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>    <!-- ヘッダー -->
    <header>
        <div class="header-container">
            <!-- ロゴ -->
            <a href="index.html" class="logo">
                <img src="images/logo.png" alt="日本語村 ロゴ">
            </a>

            <!-- モバイルメニュートグル -->
            <button class="mobile-menu-toggle" aria-label="メニュー">
                <i class="fas fa-bars"></i>
            </button>

            <!-- ナビゲーションメニュー -->
            <nav>
                <ul class="nav-menu">
                    <li><a href="seminars-public.html" data-ja="セミナー" data-en="Seminars" data-zh="研讨会">セミナー</a></li>
                    <li><a href="events-public.html" data-ja="イベント" data-en="Events" data-zh="活动">イベント</a></li>
                    <li><a href="consultations-public.html" data-ja="個別相談" data-en="Consultations" data-zh="个别咨询">個別相談</a></li>
                    <li><a href="jobs-public.html" data-ja="求人検索" data-en="Job Search" data-zh="职位搜索">求人検索</a></li>
                    <li><a href="knowledge.html" data-ja="就職知識" data-en="Career Knowledge" data-zh="就业知识">就職知識</a></li>
                </ul>
            </nav>

            <!-- 右側のアクション -->
            <div class="header-actions">
                <!-- 言語選択 -->
                <div class="language-switcher">
                    <button class="lang-btn active" data-lang="ja">日本語</button>
                    <span class="separator">/</span>
                    <button class="lang-btn" data-lang="en">English</button>
                    <span class="separator">/</span>
                    <button class="lang-btn" data-lang="zh">中文</button>
                </div>

                <!-- 認証ボタン -->
                <div class="auth-buttons">
                    <a href="auth.html" class="btn-login" data-ja="ログイン" data-en="Login" data-zh="登録">ログイン</a>
                    <a href="auth.html" class="btn-register" data-ja="無料会員登録" data-en="Free Registration" data-zh="免费注册">無料会員登録</a>
                </div>
            </div>
        </div>
    </header>


    <!-- メインコンテンツ -->
    <main class="jobs-page">
        <!-- ヒーローセクション -->
        <section class="hero-section">
            <h1>求人検索</h1>
            <p>留学生歓迎の求人情報を検索</p>
        </section>

        <!-- 検索セクション -->
        <section class="search-section">
            <div class="search-card">
                <div class="search-filters">
                    <div class="filter-group">
                        <label>キーワード</label>
                        <input type="text" id="keyword" placeholder="職種、企業名など">
                    </div>
                    <div class="filter-group">
                        <label>勤務地</label>
                        <select id="location">
                            <option value="">すべて</option>
                            <option value="東京都">東京都</option>
                            <option value="大阪府">大阪府</option>
                            <option value="愛知県">愛知県</option>
                            <option value="福岡県">福岡県</option>
                            <option value="北海道">北海道</option>
                            <option value="その他">その他</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>業種</label>
                        <select id="industry">
                            <option value="">すべて</option>
                            <option value="IT・通信">IT・通信</option>
                            <option value="製造">製造</option>
                            <option value="商社・貿易">商社・貿易</option>
                            <option value="サービス">サービス</option>
                            <option value="小売">小売</option>
                            <option value="その他">その他</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>ビザサポート</label>
                        <select id="visa">
                            <option value="">すべて</option>
                            <option value="あり">あり</option>
                        </select>
                    </div>
                </div>
                <div class="search-buttons">
                    <button class="btn btn-primary" onclick="searchJobs()">
                        <i class="fas fa-search"></i> 検索
                    </button>
                    <button class="btn btn-secondary" onclick="resetFilters()">
                        <i class="fas fa-redo"></i> リセット
                    </button>
                </div>
            </div>
        </section>

        <!-- 求人一覧 -->
        <section class="jobs-list">
            <div id="jobs-container">
                <!-- 求人カードがJavaScriptで動的に生成されます -->
            </div>
        </section>
    </main>

    <!-- フッター -->
    <footer class="footer">
        <div class="container">
            <div class="footer-links">
                <a href="contact.html">お問い合わせ</a> |
                <a href="privacy.html">プライバシーポリシー</a> |
                <a href="company.html">運営会社</a>
            </div>
            <p class="copyright">Copyright © At One Co.,Ltd. All Rights Reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/language.min.js"></script>
    <script>
        const supabase = window.supabaseClient;

        // ページ読み込み時に実行
        document.addEventListener('DOMContentLoaded', async function() {
            await loadJobs();
        });

        // 求人を読み込み
        async function loadJobs(filters = {}) {
            try {
                let query = supabase
                    .from('jobs')
                    .select('*')
                    .order('created_at', { ascending: false });

                // フィルターを適用
                if (filters.keyword) {
                    query = query.or(`title.ilike.%${filters.keyword}%,company.ilike.%${filters.keyword}%`);
                }
                if (filters.location) {
                    query = query.eq('location', filters.location);
                }
                if (filters.industry) {
                    query = query.eq('industry', filters.industry);
                }
                if (filters.visa === 'あり') {
                    query = query.eq('visa_support', true);
                }

                const { data: jobs, error } = await query;

                if (error) throw error;

                displayJobs(jobs);
            } catch (error) {
                console.error('求人読み込みエラー:', error);
                document.getElementById('jobs-container').innerHTML = `
                    <div class="no-jobs">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>求人情報の読み込みに失敗しました。</p>
                    </div>
                `;
            }
        }

        // 求人を表示
        function displayJobs(jobs) {
            const container = document.getElementById('jobs-container');

            if (!jobs || jobs.length === 0) {
                container.innerHTML = `
                    <div class="no-jobs">
                        <i class="fas fa-briefcase"></i>
                        <p>現在、該当する求人情報はありません。</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = jobs.map(job => `
                <div class="job-card">
                    <div class="job-header">
                        <div>
                            <h3 class="job-title">${job.title}</h3>
                            <p class="company-name">${job.company}</p>
                        </div>
                        <div class="job-tags">
                            ${job.visa_support ? '<span class="tag visa">ビザサポートあり</span>' : ''}
                            <span class="tag">${job.employment_type || '正社員'}</span>
                        </div>
                    </div>
                    <p>${job.description || ''}</p>
                    <div class="job-info">
                        <div class="info-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${job.location || '-'}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-briefcase"></i>
                            <span>${job.industry || '-'}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-yen-sign"></i>
                            <span>${job.salary || '-'}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-language"></i>
                            <span>${job.japanese_level || '-'}</span>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="applyJob('${job.id}')">
                        <i class="fas fa-paper-plane"></i> 応募する
                    </button>
                </div>
            `).join('');
        }

        // 求人を検索
        function searchJobs() {
            const filters = {
                keyword: document.getElementById('keyword').value,
                location: document.getElementById('location').value,
                industry: document.getElementById('industry').value,
                visa: document.getElementById('visa').value
            };
            loadJobs(filters);
        }

        // フィルターをリセット
        function resetFilters() {
            document.getElementById('keyword').value = '';
            document.getElementById('location').value = '';
            document.getElementById('industry').value = '';
            document.getElementById('visa').value = '';
            loadJobs();
        }

        // 求人に応募
        async function applyJob(jobId) {
            const { data: { user } } = await supabase.auth.getUser();

            if (!user) {
                alert('応募するにはログインが必要です。');
                window.location.href = 'auth.html';
                return;
            }

            // 応募処理（実装は省略）
            alert('応募機能は準備中です。');
        }
    </script>
</body>
</html>
